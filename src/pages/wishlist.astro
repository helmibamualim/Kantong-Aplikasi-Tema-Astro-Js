---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="Wishlist - BuildMart">
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-8 animate-fade-in">My Wishlist</h1>

    <div id="wishlist-items" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
      <!-- Wishlist items will be rendered here -->
    </div>

    <div id="empty-wishlist" class="hidden bg-white dark:bg-dark-800 rounded-2xl p-12 text-center border border-gray-200 dark:border-dark-700">
      <svg class="w-24 h-24 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
      </svg>
      <h2 class="text-2xl font-bold mb-2">Your wishlist is empty</h2>
      <p class="text-gray-600 dark:text-gray-400 mb-6">Save your favorite products here!</p>
      <a href="/products" class="inline-block px-8 py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-xl font-semibold transition-colors">
        Browse Products
      </a>
    </div>
  </div>
</BaseLayout>

<script>
  // Mock product data (in real app, fetch from API)
  const mockProducts: any = {
    '1': { id: '1', name: 'Premium Portland Cement - 50kg Bag', price: 12.99, image: 'https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=500&h=500&fit=crop', rating: 4.8, reviews: 234, inStock: true },
    '2': { id: '2', name: 'Steel Reinforcement Bars', price: 45.50, image: 'https://images.unsplash.com/photo-1587293852726-70cdb56c2866?w=500&h=500&fit=crop', rating: 4.9, reviews: 189, inStock: true },
  };

  function renderWishlist() {
    const wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
    const container = document.getElementById('wishlist-items');
    const emptyState = document.getElementById('empty-wishlist');

    if (wishlist.length === 0) {
      container!.classList.add('hidden');
      emptyState!.classList.remove('hidden');
      return;
    }

    container!.classList.remove('hidden');
    emptyState!.classList.add('hidden');

    container!.innerHTML = wishlist.map((id: string) => {
      const product = mockProducts[id] || { id, name: 'Product', price: 0, image: '', rating: 0, reviews: 0, inStock: true };
      return `
        <div class="bg-white dark:bg-dark-800 rounded-2xl overflow-hidden border border-gray-200 dark:border-dark-700 hover:border-primary-500 transition-all duration-300 hover:shadow-xl animate-scale-in">
          <div class="relative">
            <img src="${product.image}" alt="${product.name}" class="w-full aspect-square object-cover" />
            <button data-remove-wishlist="${id}" class="absolute top-4 right-4 w-10 h-10 bg-white dark:bg-dark-900 rounded-full flex items-center justify-center hover:bg-red-600 hover:text-white transition-all duration-300 shadow-lg">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>
          <div class="p-4">
            <h3 class="font-semibold mb-2 line-clamp-2">${product.name}</h3>
            <p class="text-2xl font-bold text-primary-600 dark:text-primary-400 mb-4">$${product.price.toFixed(2)}</p>
            <button data-add-to-cart-wishlist="${id}" class="w-full py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-xl font-semibold transition-all duration-300 hover:shadow-lg">
              Add to Cart
            </button>
          </div>
        </div>
      `;
    }).join('');

    // Attach event listeners
    document.querySelectorAll('[data-remove-wishlist]').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const id = (e.currentTarget as HTMLElement).dataset.removeWishlist!;
        const newWishlist = wishlist.filter((wid: string) => wid !== id);
        localStorage.setItem('wishlist', JSON.stringify(newWishlist));
        renderWishlist();
        
        // Update header count
        document.querySelectorAll('[data-wishlist-count]').forEach(el => {
          el.textContent = newWishlist.length.toString();
        });
      });
    });

    document.querySelectorAll('[data-add-to-cart-wishlist]').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const id = (e.currentTarget as HTMLElement).dataset.addToCartWishlist!;
        const product = mockProducts[id];
        if (!product) return;

        const cart = JSON.parse(localStorage.getItem('cart') || '[]');
        const existingItem = cart.find((item: any) => item.id === id);

        if (existingItem) {
          existingItem.quantity += 1;
        } else {
          cart.push({ ...product, quantity: 1 });
        }

        localStorage.setItem('cart', JSON.stringify(cart));
        
        // Update cart count
        const count = cart.reduce((sum: number, item: any) => sum + item.quantity, 0);
        document.querySelectorAll('[data-cart-count]').forEach(el => {
          el.textContent = count.toString();
        });

        // Visual feedback
        const target = e.currentTarget as HTMLElement;
        target.textContent = 'Added!';
        setTimeout(() => {
          target.textContent = 'Add to Cart';
        }, 1000);
      });
    });
  }

  renderWishlist();
</script>
