---
---

<section id="recently-viewed-section" class="container mx-auto px-4 py-16 hidden">
  <div class="flex justify-between items-center mb-8">
    <div>
      <h2 class="text-3xl font-bold mb-2">Recently Viewed</h2>
      <p class="text-gray-600 dark:text-gray-400">Products you've checked out</p>
    </div>
    <button id="clear-history" class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
      Clear History
    </button>
  </div>
  
  <div id="recently-viewed-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
    <!-- Products will be rendered here -->
  </div>
</section>

<script>
  function renderRecentlyViewed() {
    const recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
    const section = document.getElementById('recently-viewed-section');
    const grid = document.getElementById('recently-viewed-grid');
    
    if (recentlyViewed.length === 0) {
      section?.classList.add('hidden');
      return;
    }
    
    section?.classList.remove('hidden');
    
    // Mock product data (in production, fetch from API)
    const mockProducts: any = {
      '1': { id: '1', name: 'Premium Portland Cement', price: 12.99, image: 'https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=300&h=300&fit=crop' },
      '2': { id: '2', name: 'Steel Reinforcement Bars', price: 45.50, image: 'https://images.unsplash.com/photo-1587293852726-70cdb56c2866?w=300&h=300&fit=crop' },
      '3': { id: '3', name: 'Premium Pine Lumber', price: 8.99, image: 'https://images.unsplash.com/photo-1563453392212-326f5e854473?w=300&h=300&fit=crop' },
      '4': { id: '4', name: 'Power Drill Set', price: 129.99, image: 'https://images.unsplash.com/photo-1504148455328-c376907d081c?w=300&h=300&fit=crop' },
    };
    
    grid!.innerHTML = recentlyViewed.slice(0, 6).map((id: string) => {
      const product = mockProducts[id] || { id, name: 'Product', price: 0, image: '' };
      return `
        <a href="/product/${id}" class="group block bg-white dark:bg-dark-800 rounded-xl overflow-hidden border border-gray-200 dark:border-dark-700 hover:border-primary-500 dark:hover:border-primary-500 transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
          <div class="aspect-square overflow-hidden bg-gray-100 dark:bg-dark-700">
            <img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" loading="lazy" />
          </div>
          <div class="p-3">
            <h3 class="text-sm font-semibold mb-1 line-clamp-2 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors">${product.name}</h3>
            <p class="text-lg font-bold text-primary-600 dark:text-primary-400">$${product.price.toFixed(2)}</p>
          </div>
        </a>
      `;
    }).join('');
  }
  
  // Clear history
  document.getElementById('clear-history')?.addEventListener('click', () => {
    localStorage.removeItem('recentlyViewed');
    renderRecentlyViewed();
  });
  
  // Render on page load
  renderRecentlyViewed();
  
  // Track product views
  if (window.location.pathname.startsWith('/product/')) {
    const productId = window.location.pathname.split('/').pop();
    if (productId) {
      const recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
      const filtered = recentlyViewed.filter((id: string) => id !== productId);
      filtered.unshift(productId);
      localStorage.setItem('recentlyViewed', JSON.stringify(filtered.slice(0, 12)));
    }
  }
</script>
